<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Game Hub</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
:root{--panel-bg:#151515;--card-bg:#333;--muted:#666;}
html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#1e1e1e;color:#fff;}
#app{display:flex;height:100vh;overflow:hidden;}
#tagPanel{width:260px;background:var(--panel-bg);padding:18px;box-sizing:border-box;border-right:1px solid #222;display:flex;flex-direction:column;}
#tagPanel h2{margin:0 0 12px 0;font-size:18px;text-align:center;}
#tagSearch{width:100%;padding:8px 10px;border-radius:6px;border:none;outline:none;margin-bottom:12px;}
#allGamesBtn,#showFavoritesBtn{width:100%;padding:8px;border:none;border-radius:6px;cursor:pointer;margin-bottom:12px;}
#allGamesBtn{background:#4caf50;color:white;}
#showFavoritesBtn{background:#f39c12;color:white;}
#mainContent{flex:1;display:flex;flex-direction:column;}
header{background:#2c2c2c;padding:18px;display:flex;align-items:center;justify-content:space-between;}
header h1{margin:0;font-size:20px;}
#userArea{display:flex;align-items:center;gap:10px;}
#userName{color:#ddd;font-size:14px;}
#searchBar{width:50%;padding:10px;margin:16px auto;border-radius:6px;border:none;outline:none;display:block;}
#gameAreaWrap{padding:10px;overflow:auto;flex:1;}
#gameList{text-align:center;}
.game{display:inline-block;width:200px;margin:14px;background:var(--card-bg);border-radius:10px;padding:10px;position:relative;vertical-align:top;box-sizing:border-box;transition:transform .15s, background .15s;}
.game:hover{transform:scale(1.03);background:#3a3a3a;}
.gameIcon{width:100%;height:120px;object-fit:cover;border-radius:8px;display:block;margin-bottom:10px;}
.gameTitle{font-weight:600;margin-bottom:8px;text-align:left;}
.tagBadges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;}
.tagBadge{background:#222;padding:4px 8px;border-radius:999px;font-size:12px;color:#ddd;}
.playBtn{width:100%;padding:10px;border:none;border-radius:6px;background:#4caf50;color:white;cursor:pointer;margin-top:6px;}
.playBtn:active{transform:translateY(1px);}
.menuBtn{position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:50%;border:none;background:#444;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;}
.menuPopup{position:absolute;top:44px;right:10px;display:none;background:#222;padding:8px;border-radius:8px;width:160px;box-shadow:0 4px 12px rgba(0,0,0,.6);z-index:50;}
.menuPopup button{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:none;background:#444;color:#fff;cursor:pointer;text-align:left;}
.menuPopup button:hover{background:#666;}
#overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:900;}
#loginPopup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:#222;padding:24px;border-radius:12px;width:420px;max-width:92%;box-shadow:0 8px 30px rgba(0,0,0,.6);}
#loginPopup h2{margin:0 0 8px 0;font-size:18px;text-align:center;}
#loginPopup p{margin:0 0 14px 0;color:#ccc;text-align:center;}
#googleLoginBtn{display:flex;justify-content:center;}
#loginCloseBtn{position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:50%;background:#444;color:white;border:none;cursor:pointer;}
#descPopup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1001;background:#222;color:#fff;padding:22px;border-radius:10px;width:420px;max-width:94%;box-shadow:0 10px 30px rgba(0,0,0,.6);}
#descPopup h3{margin:0 0 8px 0;}
#descPopup p{margin:0 0 12px 0;color:#ddd;white-space:pre-wrap;}
.favoriteStar{position:absolute;top:10px;left:10px;font-size:22px;display:none;color:gold;cursor:pointer;pointer-events:auto;text-shadow:0 0 6px rgba(0,0,0,.7);transition:transform .2s;}
.favoriteStar:hover{transform:scale(1.2);}
#gameContainer{display:none;position:fixed;inset:0;z-index:1002;background:#000;align-items:center;justify-content:center;display:flex;}
#gameContainerInner{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;}
#gameFrame{border:none;max-width:100%;max-height:100%;width:auto;height:auto;background:#000;}
@media(max-width:800px){#tagPanel{display:none;}#searchBar{width:88%;}.game{width:45%;}}
</style>
</head>
<body>
<div id="app">
  <div id="tagPanel">
    <h2>Tag Search</h2>
    <input id="tagSearch" placeholder="Search tags..." autocomplete="off">
    <button id="allGamesBtn">All Games</button>
    <button id="showFavoritesBtn">Show Favorites</button>
  </div>

  <div id="mainContent">
    <header>
      <h1>My Game Hub</h1>
      <div id="userArea"><div id="userName"></div></div>
    </header>

    <input id="searchBar" placeholder="Search games...">

    <div id="gameAreaWrap">
      <div id="gameList">
        <!-- Geometry Dash local HTML game -->
        <div class="game" data-id="geometrydash" data-url="games/geometry dash.html" data-tags="website" data-desc="Block jumping">
          <div class="favoriteStar">⭐</div>
          <button class="menuBtn">⋮</button>
          <div class="menuPopup">
            <button class="descBtn">Description</button>
            <button class="favBtn">Add to Favorites</button>
          </div>
          <img class="gameIcon" src="images/geometrydash-icon.png" alt="Geometry Dash">
          <div class="gameTitle">Geometry Dash</div>
          <div class="tagBadges"></div>
          <button class="playBtn">Play</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="overlay"></div>

<!-- Login Popup -->
<div id="loginPopup">
  <button id="loginCloseBtn">✕</button>
  <h2>Sign up/in with your Google account to play the games</h2>
  <p>You need to sign in with Google to play and store saves in the cloud.</p>
  <div id="googleLoginBtn"></div>
</div>

<!-- Description Popup -->
<div id="descPopup">
  <button id="descCloseBtn" style="position:absolute; right:12px; top:12px; width:28px; height:28px; border-radius:50%; border:none; background:#444; color:#fff; cursor:pointer;">✕</button>
  <h3 id="descTitle">Description</h3>
  <p id="descText"></p>
</div>

<!-- Game iframe container -->
<div id="gameContainer">
  <div id="gameContainerInner">
    <iframe id="gameFrame" allowfullscreen></iframe>
  </div>
  <div style="position:absolute; top:0; width:100%; display:flex; background:#111; padding:8px; align-items:center;">
    <button id="backBtn" style="padding:8px 12px;">Back</button>
    <button id="fullscreenBtn" style="padding:8px 12px;">Fullscreen</button>
    <div style="flex:1"></div>
    <div id="currentGameLabel" style="color:#ddd; padding-right:12px;"></div>
  </div>
</div>

<script>
// ---------- Configuration ----------
const GOOGLE_CLIENT_ID = "202765528482-vcrnpmmalmt47qcvhrdr7uqtpc8sc5cs.apps.googleusercontent.com";
const ASPECT_RATIO = 16/9;

// ---------- State ----------
let userLoggedIn = false;
let currentGame = null;

// ---------- Favorites ----------
const FAVS_KEY = 'hub_favorites_v1';
function loadFavs(){ try { return JSON.parse(localStorage.getItem(FAVS_KEY)) || {}; } catch(e){ return {}; } }
function saveFavs(obj){ localStorage.setItem(FAVS_KEY, JSON.stringify(obj)); }
function refreshFavs(){
  const favs = loadFavs();
  document.querySelectorAll('.game').forEach(g=>{
    const id = g.dataset.id;
    const star = g.querySelector('.favoriteStar');
    const popupFav = g.querySelector('.favBtn');
    if(favs[id]){ star.style.display='block'; if(popupFav) popupFav.innerText='Remove Favorite'; }
    else { star.style.display='none'; if(popupFav) popupFav.innerText='Add to Favorites'; }
  });
}

// ---------- Google Sign-In ----------
function initGoogle(){
  userLoggedIn = !!localStorage.getItem('googleUser');
  google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleCredentialResponse
  });
  google.accounts.id.renderButton(
    document.getElementById("googleLoginBtn"),
    { theme: "outline", size: "large", width: 280 }
  );
}
function handleCredentialResponse(response){
  if(response && response.credential){
    localStorage.setItem('googleUser', response.credential);
    userLoggedIn = true;
    document.getElementById('loginPopup').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
    if(currentGame) { openGame(currentGame); currentGame = null; }
  }
}

// ---------- UI Init ----------
window.addEventListener('load', ()=>{
  document.getElementById('gameContainer').style.display = 'none';
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('loginPopup').style.display = 'none';
  document.getElementById('descPopup').style.display = 'none';
  initGoogle();
  initTagSearch();
  initSearchByTitle();
  initGameCards();
  refreshFavs();
});

// ---------- Tag search ----------
function initTagSearch(){
  const tagInput = document.getElementById('tagSearch');
  const allGamesBtn = document.getElementById('allGamesBtn');
  let tagSet = new Set();
  document.querySelectorAll('.game').forEach(g=>{
    if(!g.dataset.tags) return;
    g.dataset.tags.split(',').map(t=>t.trim().toLowerCase()).forEach(t=>{ if(t) tagSet.add(t); });
  });
  const allTags = Array.from(tagSet);
  const tagDropdown = document.createElement('div');
  tagDropdown.style.position = 'absolute';
  tagDropdown.style.background = '#222';
  tagDropdown.style.border = '1px solid #444';
  tagDropdown.style.borderRadius = '6px';
  tagDropdown.style.zIndex = '950';
  tagDropdown.style.maxHeight = '160px';
  tagDropdown.style.overflowY = 'auto';
  tagDropdown.style.display = 'none';
  document.getElementById('tagPanel').appendChild(tagDropdown);

  function positionDropdown(){
    const rect = tagInput.getBoundingClientRect();
    const panelRect = document.getElementById('tagPanel').getBoundingClientRect();
    tagDropdown.style.left = (rect.left - panelRect.left) + 'px';
    tagDropdown.style.top = (rect.bottom - panelRect.top + 4) + 'px';
    tagDropdown.style.width = rect.width + 'px';
  }
  window.addEventListener('resize', positionDropdown);
  tagInput.addEventListener('focus', positionDropdown);

  tagInput.addEventListener('input', ()=>{
    const val = tagInput.value.trim().toLowerCase();
    tagDropdown.innerHTML = '';
    if(!val){ tagDropdown.style.display = 'none'; showAllGames(); return; }
    const matches = allTags.filter(t => t.includes(val));
    if(matches.length === 0){ tagDropdown.style.display = 'none'; return; }
    matches.forEach(t=>{
      const div = document.createElement('div');
      div.style.padding = '6px 8px';
      div.style.cursor = 'pointer';
      div.style.color = '#ddd';
      div.innerText = t;
      div.addEventListener('click', ()=>{ applyTagFilter(t); tagInput.value = t; tagDropdown.style.display = 'none'; });
      tagDropdown.appendChild(div);
    });
    positionDropdown();
    tagDropdown.style.display = 'block';
  });

  function applyTagFilter(tag){
    document.querySelectorAll('.game').forEach(g=>{
      const tags = (g.dataset.tags || '').toLowerCase().split(',').map(x=>x.trim()).filter(Boolean);
      g.style.display = tags.includes(tag.toLowerCase()) ? 'inline-block' : 'none';
    });
  }
  function showAllGames(){
    document.querySelectorAll('.game').forEach(g=> g.style.display = 'inline-block' );
  }
  allGamesBtn.addEventListener('click', ()=>{
    tagInput.value = '';
    showAllGames();
    tagDropdown.style.display = 'none';
  });

  document.getElementById('showFavoritesBtn').addEventListener('click', ()=>{
    const favs = loadFavs();
    document.querySelectorAll('.game').forEach(g=>{
      g.style.display = favs[g.dataset.id] ? 'inline-block' : 'none';
    });
  });
}

// ---------- Title search ----------
function initSearchByTitle(){
  const searchBar = document.getElementById('searchBar');
  searchBar.addEventListener('input', e=>{
    const q = e.target.value.toLowerCase();
    document.querySelectorAll('.game').forEach(g=>{
      const title = (g.querySelector('.gameTitle')?.innerText || '').toLowerCase();
      g.style.display = title.includes(q) ? 'inline-block' : 'none';
    });
  });
}

// ---------- Game card behaviors ----------
function initGameCards(){
  document.querySelectorAll('.game').forEach(g=>{
    const badgeWrap = g.querySelector('.tagBadges');
    badgeWrap.innerHTML = '';
    if(g.dataset.tags){
      g.dataset.tags.split(',').map(t=>t.trim()).filter(Boolean).forEach(tag=>{
        const s = document.createElement('span');
        s.className = 'tagBadge';
        s.innerText = tag;
        badgeWrap.appendChild(s);
      });
    }

    const menuBtn = g.querySelector('.menuBtn');
    const popup = g.querySelector('.menuPopup');
    const descBtn = popup.querySelector('.descBtn');
    const favBtn = popup.querySelector('.favBtn');
    const star = g.querySelector('.favoriteStar');
    const playBtn = g.querySelector('.playBtn');

    menuBtn.addEventListener('click', e=>{
      e.stopPropagation();
      document.querySelectorAll('.menuPopup').forEach(p=>{ if(p !== popup) p.style.display = 'none'; });
      popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
    });

    descBtn.addEventListener('click', ()=>{
      document.getElementById('descTitle').innerText = g.querySelector('.gameTitle').innerText;
      document.getElementById('descText').innerText = g.dataset.desc || 'No description';
      document.getElementById('descPopup').style.display = 'block';
    });

    favBtn.addEventListener('click', ()=>{
      const favs = loadFavs();
      if(favs[g.dataset.id]) delete favs[g.dataset.id];
      else favs[g.dataset.id] = true;
      saveFavs(favs);
      refreshFavs();
      popup.style.display = 'none';
    });

    star.addEventListener('click', e=>{
      e.stopPropagation();
      const favs = loadFavs();
      if(favs[g.dataset.id]) delete favs[g.dataset.id];
      else favs[g.dataset.id] = true;
      saveFavs(favs);
      refreshFavs();
    });

    playBtn.addEventListener('click', ()=>{
      if(!userLoggedIn){
        currentGame = g;
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('loginPopup').style.display = 'block';
      } else {
        openGame(g);
      }
    });
  });

  document.body.addEventListener('click', ()=> document.querySelectorAll('.menuPopup').forEach(p=> p.style.display='none') );

  document.getElementById('descCloseBtn').addEventListener('click', ()=> {
    document.getElementById('descPopup').style.display = 'none';
  });

  document.getElementById('loginCloseBtn').addEventListener('click', ()=> {
    document.getElementById('loginPopup').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
    currentGame = null;
  });
}

// ---------- Open game iframe ----------
function openGame(game){
  const iframe
