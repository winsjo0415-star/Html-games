<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2D Two Player Shooter</title>
<style>
  body { margin: 0; overflow: hidden; background: #222; color: white; font-family: sans-serif; }
  #menu { position: absolute; width: 100%; height: 100%; background: #333; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  button { margin: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer; }
  #gameCanvas { display: none; background: #444; }
</style>
</head>
<body>

<div id="menu">
  <h1>2D Shooter Game</h1>
  <input id="player1Name" placeholder="Player 1 Name">
  <input id="player2Name" placeholder="Player 2 Name">
  <label>Choose Map: 
    <select id="mapSelect">
      <option value="1">Map 1</option>
      <option value="2">Map 2</option>
      <option value="3">Map 3</option>
    </select>
  </label>
  <label>Choose Character: 
    <select id="char1Select">
      <option value="red">Red</option>
      <option value="blue">Blue</option>
      <option value="green">Green</option>
    </select>
    <select id="char2Select">
      <option value="yellow">Yellow</option>
      <option value="purple">Purple</option>
      <option value="orange">Orange</option>
    </select>
  </label>
  <button onclick="startGame()">Start Game</button>
  <button onclick="toggleMusic()">Mute/Unmute Music</button>
  <h3>Last Game Result:</h3>
  <pre id="highscores"></pre>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>
<audio id="menuMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let menuMusic = document.getElementById('menuMusic');
let gameInterval;
let gameTime = 120;
let player1, player2;
let bullets = [];
let mapHurdles = [];
let keys = {};

const weapons = {
  pistol: { kills: 0, damage: 10, speed: 10 },
  sword: { kills: 0, damage: 25, melee: true },
  assaultRifle: { kills: 10, damage: 15, speed: 12 },
  sniper: { kills: 30, damage: 50, speed: 20 },
  minigun: { kills: 70, damage: 8, speed: 25 },
  rocketLauncher: { kills: 150, damage: 80, speed: 8 }
};

function updateHighscores(){
  const lastGame = JSON.parse(localStorage.getItem('lastGame')||'null');
  if(lastGame){
    document.getElementById('highscores').textContent = JSON.stringify(lastGame, null, 2);
  } else {
    document.getElementById('highscores').textContent = 'No previous game saved.';
  }
}

class Player {
  constructor(name, x, y, color, controls){
    this.name = name;
    this.x = x;
    this.y = y;
    this.width = 40;
    this.height = 60;
    this.hp = 100;
    this.kills = 0;
    this.color = color;
    this.controls = controls;
    this.isDucking = false;
    this.weapon = 'pistol';
  }
  move() {
    if(keys[this.controls.left]) this.x -= 5;
    if(keys[this.controls.right]) this.x += 5;
    if(keys[this.controls.jump] && this.y >= canvas.height - this.height) this.y -= 15;
    if(keys[this.controls.duck]) this.isDucking = true;
    else this.isDucking = false;
    this.y += 5;
    if(this.y > canvas.height - this.height) this.y = canvas.height - this.height;
    if(this.x < 0) this.x = 0;
    if(this.x + this.width > canvas.width) this.x = canvas.width - this.width;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.isDucking ? this.height/2 : this.height);
    ctx.fillStyle = 'white';
    ctx.fillText(this.name + ' HP: ' + this.hp + ' Weapon: ' + this.weapon, this.x, this.y - 10);
  }
  shoot(targetX, targetY){
    if(!weapons[this.weapon].melee){
      bullets.push({x:this.x+this.width/2, y:this.y+this.height/2, targetX, targetY, damage: weapons[this.weapon].damage, owner:this});
    } else {
      let other = (this===player1) ? player2 : player1;
      if(targetX >= other.x && targetX <= other.x+other.width && targetY >= other.y && targetY <= other.y+(other.isDucking?other.height/2:other.height)){
        other.hp -= weapons.sword.damage;
        if(other.hp <=0){ this.kills++; other.hp=0; }
      }
    }
  }
}

function startGame(){
  const p1Name = document.getElementById('player1Name').value || 'Player1';
  const p2Name = document.getElementById('player2Name').value || 'Player2';
  const char1 = document.getElementById('char1Select').value;
  const char2 = document.getElementById('char2Select').value;
  const map = document.getElementById('mapSelect').value;

  player1 = new Player(p1Name, 100, 500, char1, { jump:'w', left:'a', duck:'s', right:'d', shoot:'f' });
  player2 = new Player(p2Name, 600, 500, char2, { jump:'ArrowUp', left:'ArrowLeft', duck:'ArrowDown', right:'ArrowRight', shoot:'/' });

  setupMap(map);
  document.getElementById('menu').style.display = 'none';
  canvas.style.display = 'block';
  gameInterval = setInterval(gameLoop, 1000/60);
  setInterval(()=>{ gameTime--; if(gameTime<=0){ endGame(); }},1000);
}

function setupMap(map){
  mapHurdles = [];
  if(map==1){ mapHurdles = [ {x:300,y:500,width:200,height:20} ]; }
  if(map==2){ mapHurdles = [ {x:200,y:400,width:400,height:20}, {x:100,y:500,width:100,height:20} ]; }
  if(map==3){ mapHurdles = [ {x:150,y:450,width:500,height:20} ]; }
}

function toggleMusic(){
  menuMusic.paused ? menuMusic.play() : menuMusic.pause();
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='grey';
  mapHurdles.forEach(h => ctx.fillRect(h.x,h.y,h.width,h.height));
  player1.move();
  player2.move();
  player1.draw();
  player2.draw();

  for(let i=bullets.length-1;i>=0;i--){
    let b = bullets[i];
    let dx = b.targetX - b.x;
    let dy = b.targetY - b.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist<1){ bullets.splice(i,1); continue; }
    b.x += dx/dist*weapons[b.owner.weapon].speed;
    b.y += dy/dist*weapons[b.owner.weapon].speed;
    ctx.fillStyle='yellow';
    ctx.fillRect(b.x,b.y,5,5);
    let other = (b.owner===player1)?player2:player1;
    if(b.x >= other.x && b.x <= other.x+other.width && b.y >= other.y && b.y <= other.y+(other.isDucking?other.height/2:other.height)){
      other.hp -= b.damage;
      if(other.hp<=0){ b.owner.kills++; other.hp=0; }
      bullets.splice(i,1);
    }
  }
}

function endGame(){
  clearInterval(gameInterval);
  let winner = player1.hp > player2.hp ? player1.name : player2.name;
  alert(winner + ' WINS');
  saveGame();
  location.reload();
}

function saveGame(){
  // Overwrite previous game so only one is stored
  const lastGame = {
    date: new Date().toLocaleString(),
    player1: { name: player1.name, kills: player1.kills },
    player2: { name: player2.name, kills: player2.kills },
    winner: player1.hp > player2.hp ? player1.name : player2.name
  };
  localStorage.setItem('lastGame', JSON.stringify(lastGame));
  updateHighscores();
}

window.addEventListener('keydown', (e)=>{ keys[e.key] = true; });
window.addEventListener('keyup', (e)=>{ keys[e.key] = false; });
window.addEventListener('keydown', (e)=>{
  if(e.key===player1.controls.shoot){ player1.shoot(player2.x+player2.width/2, player2.y+player2.height/2); }
  if(e.key===player2.controls.shoot){ player2.shoot(player1.x+player1.width/2, player1.y+player1.height/2); }
});

updateHighscores();
</script>
</body>
</html>
